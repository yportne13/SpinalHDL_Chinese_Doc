<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>UInt/SInt &mdash; SpinalHDL_Chinese 1.0.0 文档</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/translations.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="next" title="SpinalEnum" href="SpinalEnum.html" />
    <link rel="prev" title="Bits" href="Bits.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> SpinalHDL_Chinese
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="在文档中搜索" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../%E5%85%B3%E4%BA%8ESpinalHDL/index.html">关于SpinalHDL(About SpinalHDL)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E5%BC%80%E5%A7%8B%E5%85%A5%E9%97%A8/index.html">开始入门(Getting Started)</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">数据类型(Data Types)</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="%E7%AE%80%E4%BB%8B.html">简介(Introduction)</a></li>
<li class="toctree-l2"><a class="reference internal" href="Bool.html">Bool</a></li>
<li class="toctree-l2"><a class="reference internal" href="Bits.html">Bits</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">UInt/SInt</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#description">一、描述(Description)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#declaration">二、声明(Declaration)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#operators">三、操作符(Operators)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fixpoint-operations">四、定点数操作(FixPoint operations)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="SpinalEnum.html">SpinalEnum</a></li>
<li class="toctree-l2"><a class="reference internal" href="Bundle.html">Bundle</a></li>
<li class="toctree-l2"><a class="reference internal" href="Vec.html">Vec</a></li>
<li class="toctree-l2"><a class="reference internal" href="Fix.html">UFix/SFix</a></li>
<li class="toctree-l2"><a class="reference internal" href="Floating.html">Floating</a></li>
<li class="toctree-l2"><a class="reference internal" href="AFix.html">AFix(AFix是最新版Spinal新增的数据结构，不知为何该板块有些代码无法通过编译)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../%E7%BB%93%E6%9E%84/index.html">结构(Structuring)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E8%AF%AD%E4%B9%89/index.html">语义(Semantic)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E6%97%B6%E5%BA%8F%E9%80%BB%E8%BE%91/index.html">时序逻辑(Sequential logic)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E8%AE%BE%E8%AE%A1%E9%94%99%E8%AF%AF/index.html">设计错误(Design Errors)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E5%85%B6%E5%AE%83%E8%AF%AD%E8%A8%80%E7%89%B9%E5%BE%81/index.html">其他语言特征(Other language features)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E5%BA%93/index.html">Libraries(库)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E4%BB%BF%E7%9C%9F/index.html">仿真(Simulation)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E5%BD%A2%E5%BC%8F%E9%AA%8C%E8%AF%81/index.html">形式验证(Formal verification)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E4%BE%8B%E5%AD%90/index.html">例子(Examples)</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">SpinalHDL_Chinese</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">数据类型(Data Types)</a> &raquo;</li>
      <li>UInt/SInt</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/doc/数据类型/Int.md.txt" rel="nofollow"> 查看页面源码</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="uint-sint">
<h1>UInt/SInt<a class="headerlink" href="#uint-sint" title="此标题的永久链接"></a></h1>
<section id="description">
<h2>一、描述(Description)<a class="headerlink" href="#description" title="此标题的永久链接"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">UInt</span></code>/<code class="docutils literal notranslate"><span class="pre">SInt</span></code>数据类型是一个能用在有/无符号计算中的bits向量</p>
</section>
<section id="declaration">
<h2>二、声明(Declaration)<a class="headerlink" href="#declaration" title="此标题的永久链接"></a></h2>
<p>声明整型的语法如下所示：([]中的是可填项)</p>
<table border="1" class="docutils">
<thead>
<tr>
<th style="text-align: center;">语法</th>
<th style="text-align: center;">描述</th>
<th style="text-align: center;">返回类型</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">UInt[()]<br>SInt[()]</td>
<td style="text-align: center;">创建有/无符号整型, bits个数编译器推断得到</td>
<td style="text-align: center;">UInt<br>SInt</td>
</tr>
<tr>
<td style="text-align: center;">UInt(x bits)<br>SInt(x bits)</td>
<td style="text-align: center;">创建x bits的有/无符号整型</td>
<td style="text-align: center;">UInt<br>SInt</td>
</tr>
<tr>
<td style="text-align: center;">U(value: Int[, xbits])<br>U(value: BigInt[, x bits])<br>S(value: Int[, x bits])<br>S(value: BigInt[, x bits])</td>
<td style="text-align: center;">创建有/无符号整型, 并赋值'value'</td>
<td style="text-align: center;">UInt<br>SInt</td>
</tr>
<tr>
<td style="text-align: center;">U"[[size']base]value"<br>S"[[size']base]value"</td>
<td style="text-align: center;">创建有/无符号整型, 并赋值'value'(基：h, d, o, b)</td>
<td style="text-align: center;">UInt<br>SInt</td>
</tr>
<tr>
<td style="text-align: center;">U([x bits, ] element, ...)<br>S([x bits, ] element, ...)</td>
<td style="text-align: center;">创建有/无符号整型, 赋值由element决定</td>
<td style="text-align: center;">UInt<br>SInt</td>
</tr>
</tbody>
</table><div class="highlight-Scala notranslate"><div class="highlight"><pre><span></span><span class="kd">val</span><span class="w"> </span><span class="n">myUInt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">UInt</span><span class="p">(</span><span class="mi">8</span><span class="w"> </span><span class="n">bits</span><span class="p">)</span><span class="w"></span>
<span class="n">myUInt</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nc">U</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="n">bits</span><span class="p">)</span><span class="w"></span>
<span class="n">myUInt</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nc">U</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="n">myUInt</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nc">U</span><span class="s">&quot;0000_0101&quot;</span><span class="w">  </span><span class="c1">//基默认二进制</span>
<span class="n">myUInt</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nc">U</span><span class="s">&quot;h1A&quot;</span><span class="w">        </span><span class="c1">//x/h-&gt;基16, d-&gt;基10, o-&gt;基8, b-&gt;基2</span>
<span class="n">myUInt</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nc">U</span><span class="s">&quot;8&#39;h1A&quot;</span><span class="w"></span>
<span class="n">myUInt</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">2</span><span class="w">             </span><span class="c1">//可以使用Scala Int作为字面值</span>

<span class="kd">val</span><span class="w"> </span><span class="n">myBool</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">myUInt</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nc">U</span><span class="p">(</span><span class="mi">7</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">downto</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"></span>
<span class="kd">val</span><span class="w"> </span><span class="n">myBool</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">myUInt</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nc">U</span><span class="p">(</span><span class="n">myUInt</span><span class="p">.</span><span class="n">range</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w"></span>

<span class="c1">//在赋值的时候, 可以去掉U/S, 也支持[default -&gt; ???]</span>
<span class="n">myUInt</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">(</span><span class="n">default</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w">                 </span><span class="c1">//赋值“11111111”</span>
<span class="n">myUInt</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">(</span><span class="n">myUInt</span><span class="p">.</span><span class="n">range</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w">            </span><span class="c1">//赋值“11111111</span>

<span class="n">myUInt</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">(</span><span class="mi">7</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">default</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w">     </span><span class="c1">//赋值“10000000”</span>
<span class="n">myUInt</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">((</span><span class="mi">4</span><span class="w"> </span><span class="n">downto</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">default</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w">  </span><span class="c1">//赋值“00011110”</span>
</pre></div>
</div>
<div class="highlight-Verilog notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">myUInt</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">reg</span><span class="w">        </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">_zz_myBool</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">wire</span><span class="w">                </span><span class="n">myBool</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="k">function</span><span class="w"> </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">zz__zz_myBool</span><span class="p">(</span><span class="k">input</span><span class="w"> </span><span class="n">dummy</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">begin</span><span class="w"></span>
<span class="w">      </span><span class="n">zz__zz_myBool</span><span class="p">[</span><span class="mh">7</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">&#39;b1</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">zz__zz_myBool</span><span class="p">[</span><span class="mh">6</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">7&#39;h0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="w">  </span><span class="k">endfunction</span><span class="w"></span>
<span class="w">  </span><span class="kt">wire</span><span class="w"> </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">_zz_1</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="k">assign</span><span class="w"> </span><span class="n">myUInt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8&#39;h02</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">assign</span><span class="w"> </span><span class="n">myUInt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8&#39;h02</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">assign</span><span class="w"> </span><span class="n">myUInt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8&#39;h05</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">assign</span><span class="w"> </span><span class="n">myUInt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8&#39;h1A</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">assign</span><span class="w"> </span><span class="n">myUInt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8&#39;h1A</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">assign</span><span class="w"> </span><span class="n">myUInt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8&#39;h02</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span>
<span class="w">  </span><span class="k">assign</span><span class="w"> </span><span class="n">_zz_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zz__zz_myBool</span><span class="p">(</span><span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="k">always</span><span class="w"> </span><span class="p">@(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">_zz_myBool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_zz_1</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">assign</span><span class="w"> </span><span class="n">myBool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">myUInt</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">_zz_myBool</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="k">assign</span><span class="w"> </span><span class="n">_zz_myBool</span><span class="p">[</span><span class="mh">7</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8&#39;hff</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">assign</span><span class="w"> </span><span class="n">myBool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">myUInt</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">_zz_myBool</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="k">assign</span><span class="w"> </span><span class="n">myUInt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8&#39;hff</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">assign</span><span class="w"> </span><span class="n">myUInt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8&#39;hff</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">assign</span><span class="w"> </span><span class="n">myUInt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8&#39;h80</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">assign</span><span class="w"> </span><span class="n">myUInt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8&#39;h1E</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="operators">
<h2>三、操作符(Operators)<a class="headerlink" href="#operators" title="此标题的永久链接"></a></h2>
<p>下面是<code class="docutils literal notranslate"><span class="pre">UInt</span></code>和<code class="docutils literal notranslate"><span class="pre">SInt</span></code>支持的操作符：</p>
<ol class="simple">
<li><p>逻辑运算(Logic)##这里有问题##</p></li>
</ol>
<table border="1" class="docutils">
<thead>
<tr>
<th style="text-align: center;">操作符</th>
<th style="text-align: center;">描述</th>
<th style="text-align: center;">返回类型</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">x ^ y</td>
<td style="text-align: center;">逻辑异或</td>
<td style="text-align: center;">Bool</td>
</tr>
<tr>
<td style="text-align: center;">~x</td>
<td style="text-align: center;">按位取非</td>
<td style="text-align: center;">T(w(x) bits)</td>
</tr>
<tr>
<td style="text-align: center;">x &amp; y</td>
<td style="text-align: center;">按位与</td>
<td style="text-align: center;">T(max(w(x), w(y)) bits)</td>
</tr>
<tr>
<td style="text-align: center;">x &#124; y</td>
<td style="text-align: center;">按位或</td>
<td style="text-align: center;">T(max(w(x), w(y)) bits)</td>
</tr>
<tr>
<td style="text-align: center;">x ^ y</td>
<td style="text-align: center;">按位异或</td>
<td style="text-align: center;">T(max(w(x), w(y)) bits)</td>
</tr>
<tr>
<td style="text-align: center;">x.xorR</td>
<td style="text-align: center;">x的所有bits取异或</td>
<td style="text-align: center;">Bool</td>
</tr>
<tr>
<td style="text-align: center;">x.orR</td>
<td style="text-align: center;">x的所有bits取或</td>
<td style="text-align: center;">Bool</td>
</tr>
<tr>
<td style="text-align: center;">x.andR</td>
<td style="text-align: center;">x的所有bits取与</td>
<td style="text-align: center;">Bool</td>
</tr>
<tr>
<td style="text-align: center;">x &gt;&gt; y</td>
<td style="text-align: center;">算术右移, y: Int</td>
<td style="text-align: center;">T(w(x)-y bits)</td>
</tr>
<tr>
<td style="text-align: center;">x &gt;&gt; y</td>
<td style="text-align: center;">算术右移, y: UInt</td>
<td style="text-align: center;">T(w(x) bits)</td>
</tr>
<tr>
<td style="text-align: center;">x &lt;&lt; y</td>
<td style="text-align: center;">算术左移, y: Int</td>
<td style="text-align: center;">T(w(x)+y bits)</td>
</tr>
<tr>
<td style="text-align: center;">x &lt;&lt; y</td>
<td style="text-align: center;">算术左移, y: UInt</td>
<td style="text-align: center;">T(w(x)+max(y) bits)</td>
</tr>
<tr>
<td style="text-align: center;">x</td>
<td style="text-align: center;">&gt;&gt; y</td>
<td style="text-align: center;">逻辑右移, y: Int/UInt</td>
</tr>
<tr>
<td style="text-align: center;">x</td>
<td style="text-align: center;">&lt;&lt; y</td>
<td style="text-align: center;">逻辑左移, y: Int/UInt</td>
</tr>
<tr>
<td style="text-align: center;">x.rotateLeft(y)</td>
<td style="text-align: center;">逻辑循环左移, y: UInt/Int</td>
<td style="text-align: center;">T(w(x) bits)</td>
</tr>
<tr>
<td style="text-align: center;">x.rotateRight(y)</td>
<td style="text-align: center;">逻辑循环右移, y: UInt/Int</td>
<td style="text-align: center;">T(w(x) bits)</td>
</tr>
<tr>
<td style="text-align: center;">x.clearAll[()]</td>
<td style="text-align: center;">清除所有bits</td>
<td style="text-align: center;"></td>
</tr>
<tr>
<td style="text-align: center;">x.setAll[()]</td>
<td style="text-align: center;">置位所有bits</td>
<td style="text-align: center;"></td>
</tr>
<tr>
<td style="text-align: center;">x.setAllTo(value: Boolean)</td>
<td style="text-align: center;">根据给定Boolean值置位</td>
<td style="text-align: center;"></td>
</tr>
<tr>
<td style="text-align: center;">x.setAllTo(value: Bool)</td>
<td style="text-align: center;">根据给定Bool值置位</td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table><blockquote>
<div><p>备注：<code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">rotateLeft</span> <span class="pre">y</span></code>和<code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">rotateRight</span> <span class="pre">y</span></code>也是有效语句</p>
</div></blockquote>
<blockquote>
<div><p>备注：注意<code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">&gt;&gt;</span> <span class="pre">2</span></code>和<code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">&gt;&gt;</span> <span class="pre">U(2)</span></code>的区别, 前者返回类型是<code class="docutils literal notranslate"><span class="pre">T(w(x)-2)</span></code>, 后者返回类型是<code class="docutils literal notranslate"><span class="pre">T(w(x))</span></code>, 其次更重要的是, 前者的2视为Int后者的U(2)视为硬件信号。</p>
</div></blockquote>
<div class="highlight-Scala notranslate"><div class="highlight"><pre><span></span><span class="kd">val</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">SInt</span><span class="p">(</span><span class="mi">32</span><span class="w"> </span><span class="n">bits</span><span class="p">)</span><span class="w"></span>
<span class="n">a</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nc">S</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"></span>
<span class="n">b</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nc">S</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"></span>

<span class="c1">//比特级操作</span>
<span class="n">c</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">~</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="n">&amp;</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"></span>
<span class="n">assert</span><span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="n">getWidth</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">32</span><span class="p">)</span><span class="w"></span>

<span class="c1">//移位</span>
<span class="kd">val</span><span class="w"> </span><span class="n">arithShift</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">UInt</span><span class="p">(</span><span class="mi">8</span><span class="w"> </span><span class="n">bits</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">2</span><span class="w">  </span><span class="c1">//结果10 bits</span>
<span class="kd">val</span><span class="w"> </span><span class="n">logicShift</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">UInt</span><span class="p">(</span><span class="mi">8</span><span class="w"> </span><span class="n">bits</span><span class="p">)</span><span class="w"> </span><span class="o">|&lt;&lt;</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="c1">//结果8 bits</span>
<span class="n">assert</span><span class="p">(</span><span class="n">arithShift</span><span class="p">.</span><span class="n">getWidth</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"></span>
<span class="n">assert</span><span class="p">(</span><span class="n">logicShift</span><span class="p">.</span><span class="n">getWidth</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"></span>

<span class="c1">//循环移位</span>
<span class="kd">val</span><span class="w"> </span><span class="n">rotated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">UInt</span><span class="p">(</span><span class="mi">8</span><span class="w"> </span><span class="n">bits</span><span class="p">)</span><span class="w"> </span><span class="n">rotateLeft</span><span class="w"> </span><span class="mi">3</span><span class="w"></span>
<span class="n">assert</span><span class="p">(</span><span class="n">rotated</span><span class="p">.</span><span class="n">getWidth</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"></span>

<span class="c1">//当a全1, b也全1</span>
<span class="n">when</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">andR</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">setAll</span><span class="p">()</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Verilog:</p>
<div class="highlight-Verilog notranslate"><div class="highlight"><pre><span></span><span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">31</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">_zz_c</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">31</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">a</span><span class="p">;</span><span class="w"></span>
<span class="kt">reg</span><span class="w">        </span><span class="p">[</span><span class="mh">31</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">31</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">c</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">_zz_arithShift</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">9</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">arithShift</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">_zz_logicShift</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">logicShift</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">_zz_rotated</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">rotated</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">                </span><span class="n">when_MyTopLevel_l51</span><span class="p">;</span><span class="w"></span>

<span class="k">assign</span><span class="w"> </span><span class="n">_zz_c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">32&#39;h00000005</span><span class="p">;</span><span class="w"></span>
<span class="k">always</span><span class="w"> </span><span class="p">@(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">    </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">32&#39;h0000000a</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">when_MyTopLevel_l51</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">32&#39;hffffffff</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="k">assign</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">_zz_c</span><span class="p">);</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">arithShift</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">({</span><span class="mh">2</span><span class="mi">&#39;d0</span><span class="p">,</span><span class="n">_zz_arithShift</span><span class="p">}</span><span class="w"> </span><span class="o">&lt;&lt;&lt;</span><span class="w"> </span><span class="mh">2</span><span class="p">);</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">logicShift</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">_zz_logicShift</span><span class="w"> </span><span class="o">&lt;&lt;&lt;</span><span class="w"> </span><span class="mh">2</span><span class="p">);</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">rotated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">_zz_rotated</span><span class="p">[</span><span class="mh">4</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">0</span><span class="p">],</span><span class="n">_zz_rotated</span><span class="p">[</span><span class="mh">7</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">5</span><span class="p">]};</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">when_MyTopLevel_l51</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="n">a</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<ol class="simple">
<li><p>运算(Arithmetic)</p></li>
</ol>
<table border="1" class="docutils">
<thead>
<tr>
<th style="text-align: center;">操作符</th>
<th style="text-align: center;">描述</th>
<th style="text-align: center;">返回类型</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">x+y</td>
<td style="text-align: center;">加法</td>
<td style="text-align: center;">T(max(w(x), w(y)) bits)</td>
</tr>
<tr>
<td style="text-align: center;">x+^y</td>
<td style="text-align: center;">产生进位加</td>
<td style="text-align: center;">T(max(w(x), w(y))+1 bits)</td>
</tr>
<tr>
<td style="text-align: center;">x+&#124;y</td>
<td style="text-align: center;">溢出判断加</td>
<td style="text-align: center;">T(max(w(x), w(y)) bits)</td>
</tr>
<tr>
<td style="text-align: center;">x-y</td>
<td style="text-align: center;">减法</td>
<td style="text-align: center;">T(max(w(x), w(y)) bits)</td>
</tr>
<tr>
<td style="text-align: center;">x-^y</td>
<td style="text-align: center;">产生借位减</td>
<td style="text-align: center;">T(max(w(x), w(y))+1 bits)</td>
</tr>
<tr>
<td style="text-align: center;">x-</td>
<td style="text-align: center;">y</td>
<td style="text-align: center;">减法</td>
</tr>
<tr>
<td style="text-align: center;">x*y</td>
<td style="text-align: center;">乘法</td>
<td style="text-align: center;">T(max(w(x), w(y)) bits)</td>
</tr>
<tr>
<td style="text-align: center;">x/y</td>
<td style="text-align: center;">除法</td>
<td style="text-align: center;">T(w(x)bits)</td>
</tr>
<tr>
<td style="text-align: center;">x%y</td>
<td style="text-align: center;">取模</td>
<td style="text-align: center;">T(w(x)bits)</td>
</tr>
</tbody>
</table><div class="highlight-Scala notranslate"><div class="highlight"><pre><span></span><span class="kd">val</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">UInt</span><span class="p">(</span><span class="mi">8</span><span class="w"> </span><span class="n">bits</span><span class="p">)</span><span class="w"></span>
<span class="n">a</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nc">U</span><span class="s">&quot;xf0&quot;</span><span class="w"></span>
<span class="n">b</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nc">U</span><span class="s">&quot;x0f&quot;</span><span class="w"></span>

<span class="n">c</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="w"></span>
<span class="n">assert</span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nc">U</span><span class="s">&quot;8&#39;xff&quot;</span><span class="p">)</span><span class="w"></span>

<span class="kd">val</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+^</span><span class="w"> </span><span class="n">b</span><span class="w"></span>
<span class="n">assert</span><span class="p">(</span><span class="n">d</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nc">U</span><span class="s">&quot;9&#39;x0ff&quot;</span><span class="p">)</span><span class="w"></span>

<span class="kd">val</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+|</span><span class="w"> </span><span class="nc">U</span><span class="s">&quot;8&#39;x20&quot;</span><span class="w"></span>
<span class="n">assert</span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nc">U</span><span class="s">&quot;8&#39;xff&quot;</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>Verilog:</p>
<div class="highlight-Verilog notranslate"><div class="highlight"><pre><span></span><span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">a</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">c</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">8</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">d</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">8</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">_zz_e</span><span class="p">;</span><span class="w"></span>
<span class="kt">reg</span><span class="w">        </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">e</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">                </span><span class="n">when_UInt_l119</span><span class="p">;</span><span class="w"></span>
<span class="kt">reg</span><span class="w">        </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">counter</span><span class="p">;</span><span class="w"></span>

<span class="k">assign</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8&#39;hf0</span><span class="p">;</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8&#39;h0f</span><span class="p">;</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">({</span><span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">,</span><span class="n">a</span><span class="p">}</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">{</span><span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">,</span><span class="n">b</span><span class="p">});</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">_zz_e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">({</span><span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">,</span><span class="n">a</span><span class="p">}</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">{</span><span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">,</span><span class="mh">8&#39;h20</span><span class="p">});</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">when_UInt_l119</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">|</span><span class="n">_zz_e</span><span class="p">[</span><span class="mh">8</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">8</span><span class="p">]);</span><span class="w"></span>
<span class="k">always</span><span class="w"> </span><span class="p">@(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">when_UInt_l119</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="n">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8&#39;hff</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="n">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_zz_e</span><span class="p">[</span><span class="mh">7</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">0</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
</pre></div>
</div>
<blockquote>
<div><p>备注：需要注意的是, 该例程的仿真assert用的是<code class="docutils literal notranslate"><span class="pre">===</span></code>, 而相对的上一例程中细化assert用的是<code class="docutils literal notranslate"><span class="pre">==</span></code></p>
</div></blockquote>
<ol class="simple">
<li><p>对比操作(Comparison)</p></li>
</ol>
<table border="1" class="docutils">
<thead>
<tr>
<th style="text-align: center;">操作符</th>
<th style="text-align: center;">描述</th>
<th style="text-align: center;">返回类型</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">x===y</td>
<td style="text-align: center;">相等</td>
<td style="text-align: center;">Bool</td>
</tr>
<tr>
<td style="text-align: center;">x=/=</td>
<td style="text-align: center;">不相等</td>
<td style="text-align: center;">Bool</td>
</tr>
<tr>
<td style="text-align: center;">x&gt;y</td>
<td style="text-align: center;">大于</td>
<td style="text-align: center;">Bool</td>
</tr>
<tr>
<td style="text-align: center;">x&gt;=y</td>
<td style="text-align: center;">大于等于</td>
<td style="text-align: center;">Bool</td>
</tr>
<tr>
<td style="text-align: center;">x&lt;y</td>
<td style="text-align: center;">小于</td>
<td style="text-align: center;">Bool</td>
</tr>
<tr>
<td style="text-align: center;">x&lt;=y</td>
<td style="text-align: center;">小于等于</td>
<td style="text-align: center;">Bool</td>
</tr>
</tbody>
</table><div class="highlight-Scala notranslate"><div class="highlight"><pre><span></span><span class="kd">val</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">U</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="n">bits</span><span class="p">)</span><span class="w"></span>
<span class="kd">val</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">U</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="n">bits</span><span class="p">)</span><span class="w"></span>
<span class="kd">val</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">UInt</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="n">bits</span><span class="p">)</span><span class="w"></span>

<span class="n">when</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">c</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nc">U</span><span class="s">&quot;10&quot;</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="n">elsewhen</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">=/=</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">c</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nc">U</span><span class="s">&quot;01&quot;</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="n">elsewhen</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nc">U</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">c</span><span class="p">.</span><span class="n">setAll</span><span class="p">()</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="n">otherwise</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">c</span><span class="p">.</span><span class="n">clearAll</span><span class="p">()</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Verilog:</p>
<div class="highlight-Verilog notranslate"><div class="highlight"><pre><span></span><span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">a</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<span class="kt">reg</span><span class="w">        </span><span class="p">[</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">c</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">                </span><span class="n">when_MyTopLevel_l39</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">                </span><span class="n">when_MyTopLevel_l41</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">                </span><span class="n">when_MyTopLevel_l43</span><span class="p">;</span><span class="w"></span>
<span class="kt">reg</span><span class="w">        </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">counter</span><span class="p">;</span><span class="w"></span>

<span class="k">assign</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8&#39;h05</span><span class="p">;</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8&#39;h0a</span><span class="p">;</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">when_MyTopLevel_l39</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">b</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">a</span><span class="p">);</span><span class="w"></span>
<span class="k">always</span><span class="w"> </span><span class="p">@(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">when_MyTopLevel_l39</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">2</span><span class="mb">&#39;b10</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">when_MyTopLevel_l41</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">2</span><span class="mb">&#39;b01</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">when_MyTopLevel_l43</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">                </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">2</span><span class="mb">&#39;b11</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">end</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">                </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">2</span><span class="mb">&#39;b00</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">end</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="n">ssign</span><span class="w"> </span><span class="n">when_MyTopLevel_l41</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">when_MyTopLevel_l43</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">8&#39;h0</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<ol class="simple">
<li><p>类型转换(Type cast)</p></li>
</ol>
<table border="1" class="docutils">
<thead>
<tr>
<th style="text-align: center;">操作符</th>
<th style="text-align: center;">描述</th>
<th style="text-align: center;">返回类型</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">x.asBits</td>
<td style="text-align: center;">二进制转换成Bits</td>
<td style="text-align: center;">Bits(w(x) bits)</td>
</tr>
<tr>
<td style="text-align: center;">x.asUInt</td>
<td style="text-align: center;">二进制转换成UInt</td>
<td style="text-align: center;">UInt(w(x) bits)</td>
</tr>
<tr>
<td style="text-align: center;">x.asSInt</td>
<td style="text-align: center;">二进制转换成SInt</td>
<td style="text-align: center;">SInt(w(x) bits)</td>
</tr>
<tr>
<td style="text-align: center;">x.asBools</td>
<td style="text-align: center;">转换成Bool数组</td>
<td style="text-align: center;">Vec(Bool, w(x))</td>
</tr>
<tr>
<td style="text-align: center;">S(x:T)</td>
<td style="text-align: center;">把数据转换成SInt</td>
<td style="text-align: center;">SInt(w(x) bits)</td>
</tr>
<tr>
<td style="text-align: center;">U(x:T)</td>
<td style="text-align: center;">把数据转换成UInt</td>
<td style="text-align: center;">UInt(w(x) bits)</td>
</tr>
<tr>
<td style="text-align: center;">x.intoSInt</td>
<td style="text-align: center;">扩展符号位转换成SInt</td>
<td style="text-align: center;">SInt(w(x)+1 bits)</td>
</tr>
</tbody>
</table><p>将<code class="docutils literal notranslate"><span class="pre">Bool</span></code>, <code class="docutils literal notranslate"><span class="pre">Bits</span></code>, <code class="docutils literal notranslate"><span class="pre">SInt</span></code>转化成<code class="docutils literal notranslate"><span class="pre">UInt</span></code>可以用<code class="docutils literal notranslate"><span class="pre">U(something)</span></code>, 将类型转化为SInt的时候可以用<code class="docutils literal notranslate"><span class="pre">S(something)</span></code>。</p>
<div class="highlight-Scala notranslate"><div class="highlight"><pre><span></span><span class="c1">//把SInt转换成Bits</span>
<span class="kd">val</span><span class="w"> </span><span class="n">myBits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mySInt</span><span class="p">.</span><span class="n">asBits</span><span class="w"></span>

<span class="c1">//创建一个Bool量</span>
<span class="kd">val</span><span class="w"> </span><span class="n">myVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myUint</span><span class="p">.</span><span class="n">asBools</span><span class="w"></span>

<span class="c1">//把Bits转换成SInt</span>
<span class="kd">val</span><span class="w"> </span><span class="n">mySInt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">S</span><span class="p">(</span><span class="n">myBits</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>Verilog:</p>
<div class="highlight-Verilog notranslate"><div class="highlight"><pre><span></span><span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">mySInt</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">myUInt</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">myBits</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">                </span><span class="n">myVec_0</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">                </span><span class="n">myVec_1</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">                </span><span class="n">myVec_2</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">                </span><span class="n">myVec_3</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">                </span><span class="n">myVec_4</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">                </span><span class="n">myVec_5</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">                </span><span class="n">myVec_6</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">                </span><span class="n">myVec_7</span><span class="p">;</span><span class="w"></span>

<span class="k">assign</span><span class="w"> </span><span class="n">myBits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mySInt</span><span class="p">;</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">myVec_0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myUInt</span><span class="p">[</span><span class="mh">0</span><span class="p">];</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">myVec_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myUInt</span><span class="p">[</span><span class="mh">1</span><span class="p">];</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">myVec_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myUInt</span><span class="p">[</span><span class="mh">2</span><span class="p">];</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">myVec_3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myUInt</span><span class="p">[</span><span class="mh">3</span><span class="p">];</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">myVec_4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myUInt</span><span class="p">[</span><span class="mh">4</span><span class="p">];</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">myVec_5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myUInt</span><span class="p">[</span><span class="mh">5</span><span class="p">];</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">myVec_6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myUInt</span><span class="p">[</span><span class="mh">6</span><span class="p">];</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">myVec_7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myUInt</span><span class="p">[</span><span class="mh">7</span><span class="p">];</span><span class="w"></span>

<span class="k">assign</span><span class="w"> </span><span class="n">mySInt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myBits</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<ol class="simple">
<li><p>提取比特位(Bit extraction)</p></li>
</ol>
<table border="1" class="docutils">
<thead>
<tr>
<th style="text-align: center;">操作符</th>
<th style="text-align: center;">描述</th>
<th style="text-align: center;">返回类型</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">x(y)</td>
<td style="text-align: center;">读第y bits的值</td>
<td style="text-align: center;">Bool</td>
</tr>
<tr>
<td style="text-align: center;">x(offset, width)</td>
<td style="text-align: center;">读bit区域, offset: UInt, width: Int</td>
<td style="text-align: center;">T(width bits)</td>
</tr>
<tr>
<td style="text-align: center;">x(range)</td>
<td style="text-align: center;">读某范围内bits, 例如myBits(4 downto 2)</td>
<td style="text-align: center;">T(range bits)</td>
</tr>
<tr>
<td style="text-align: center;">x(y):=z</td>
<td style="text-align: center;">赋值某bit, y:Int/UInt</td>
<td style="text-align: center;">Bool</td>
</tr>
<tr>
<td style="text-align: center;">x(offset, width):=z</td>
<td style="text-align: center;">赋值bit区域, offset:UInt, width:Int</td>
<td style="text-align: center;">T(width bits)</td>
</tr>
<tr>
<td style="text-align: center;">x(range):=z</td>
<td style="text-align: center;">赋值某范围内bits, 例如myBits(4 downto 2):=U"010"</td>
<td style="text-align: center;">T(range bits)</td>
</tr>
</tbody>
</table><div class="highlight-Scala notranslate"><div class="highlight"><pre><span></span><span class="c1">//取第4bit数据</span>
<span class="kd">val</span><span class="w"> </span><span class="n">myBool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myUInt</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"></span>

<span class="c1">//把第1bit赋值为True</span>
<span class="n">mySInt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nc">True</span><span class="w"></span>

<span class="c1">//范围内赋值</span>
<span class="kd">val</span><span class="w"> </span><span class="n">myUInt_8bits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myUInt_16bits</span><span class="p">(</span><span class="mi">7</span><span class="w"> </span><span class="n">downto</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="kd">val</span><span class="w"> </span><span class="n">myUInt_7bits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myUInt_16bits</span><span class="p">(</span><span class="mi">0</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"></span>
<span class="kd">val</span><span class="w"> </span><span class="n">myUInt_6bits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myUInt_16bits</span><span class="p">(</span><span class="mi">0</span><span class="w"> </span><span class="n">until</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"></span>

<span class="n">mySInt_8bits</span><span class="p">(</span><span class="mi">3</span><span class="w"> </span><span class="n">downto</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">mySInt_4bits</span><span class="w"></span>
</pre></div>
</div>
<p>Verilog:</p>
<div class="highlight-Verilog notranslate"><div class="highlight"><pre><span></span><span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">myUInt</span><span class="p">;</span><span class="w"></span>
<span class="kt">reg</span><span class="w">        </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">mySInt</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">myUInt_16bits</span><span class="p">;</span><span class="w"></span>
<span class="kt">reg</span><span class="w">        </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">mySInt_8bits</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">mySInt_4bits</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">                </span><span class="n">myBool</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">myUInt_8bits</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">6</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">myUInt_7bits</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">5</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">myUInt_6bits</span><span class="p">;</span><span class="w"></span>

<span class="k">assign</span><span class="w"> </span><span class="n">myUInt_16bits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mh">8</span><span class="mi">&#39;d0</span><span class="p">,</span><span class="w"> </span><span class="n">myUInt</span><span class="p">};</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">myBool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myUInt</span><span class="p">[</span><span class="mh">4</span><span class="p">];</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">myUInt_8bits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myUInt_16bits</span><span class="p">[</span><span class="mh">7</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">0</span><span class="p">];</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">myUInt_7bits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myUInt_16bits</span><span class="p">[</span><span class="mh">6</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">0</span><span class="p">];</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">myUInt_6bits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myUInt_16bits</span><span class="p">[</span><span class="mh">5</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">0</span><span class="p">];</span><span class="w"></span>
<span class="k">always</span><span class="w"> </span><span class="p">@(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">    </span><span class="n">mySInt_8bits</span><span class="p">[</span><span class="mh">3</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mySInt_4bits</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">mySInt_8bits</span><span class="p">[</span><span class="mh">7</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">4</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">4</span><span class="mb">&#39;b0000</span><span class="p">;</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="k">always</span><span class="w"> </span><span class="p">@(</span><span class="k">posedge</span><span class="w"> </span><span class="n">clk</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="k">posedge</span><span class="w"> </span><span class="n">reset</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">reset</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="n">mySInt</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mh">8&#39;h0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="n">mySInt</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mh">1</span><span class="mb">&#39;b1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
</pre></div>
</div>
<ol class="simple">
<li><p>Misc</p></li>
</ol>
<table border="1" class="docutils">
<thead>
<tr>
<th style="text-align: center;">操作符</th>
<th style="text-align: center;">描述</th>
<th style="text-align: center;">返回类型</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">x.getWidth</td>
<td style="text-align: center;">返回bit位数</td>
<td style="text-align: center;">Int</td>
</tr>
<tr>
<td style="text-align: center;">x.msb</td>
<td style="text-align: center;">返回最高有效位</td>
<td style="text-align: center;">Bool</td>
</tr>
<tr>
<td style="text-align: center;">x.lsb</td>
<td style="text-align: center;">返回最低有效位</td>
<td style="text-align: center;">Bool</td>
</tr>
<tr>
<td style="text-align: center;">x.range</td>
<td style="text-align: center;">返回区间范围(x.high到0)</td>
<td style="text-align: center;">Range</td>
</tr>
<tr>
<td style="text-align: center;">x.high</td>
<td style="text-align: center;">返回x的上限</td>
<td style="text-align: center;">Int</td>
</tr>
<tr>
<td style="text-align: center;">x##y</td>
<td style="text-align: center;">数据拼接, x-&gt;高位, y-&gt;低位</td>
<td style="text-align: center;">Bits(w(x)+w(y) bits)</td>
</tr>
<tr>
<td style="text-align: center;">x@@y</td>
<td style="text-align: center;">数据拼接, x:T, y:Bool/SInt/UInt</td>
<td style="text-align: center;">T(w(x)+w(y) bits)</td>
</tr>
<tr>
<td style="text-align: center;">x.subdivideln(y slices)</td>
<td style="text-align: center;">把x切片成y份, y:Int</td>
<td style="text-align: center;">Vec(T,y)</td>
</tr>
<tr>
<td style="text-align: center;">x.subdivideln(y bits)</td>
<td style="text-align: center;">把x按y bits切片, y:Int</td>
<td style="text-align: center;">Vec(T,w(x)/y)</td>
</tr>
<tr>
<td style="text-align: center;">x.resize(y)</td>
<td style="text-align: center;">返回x的长度变换后的复制, UInt长度增大补零, SInt长度增大补符号位, y:Int</td>
<td style="text-align: center;">T(y bits)</td>
</tr>
<tr>
<td style="text-align: center;">x.resized</td>
<td style="text-align: center;">返回按需自动确定长度的x</td>
<td style="text-align: center;">T(w(x) bits)</td>
</tr>
<tr>
<td style="text-align: center;">myUInt.twoComplement(en:Bool)</td>
<td style="text-align: center;">用补码把UInt转换成SInt</td>
<td style="text-align: center;">SInt(w(myUInt)+1)</td>
</tr>
<tr>
<td style="text-align: center;">mySInt.abs</td>
<td style="text-align: center;">返回UInt类型的绝对值</td>
<td style="text-align: center;">UInt(w(mySInt),bits)</td>
</tr>
<tr>
<td style="text-align: center;">mySInt.abs(en:Bool)</td>
<td style="text-align: center;">如果en是True返回UInt类型的绝对值</td>
<td style="text-align: center;">UInt(w(mySInt),bits)</td>
</tr>
<tr>
<td style="text-align: center;">mySInt.sign</td>
<td style="text-align: center;">返回最高有效位</td>
<td style="text-align: center;">Bool</td>
</tr>
<tr>
<td style="text-align: center;">x.expand</td>
<td style="text-align: center;">返回1bit拓展后的x</td>
<td style="text-align: center;">T(w(x)+1 bits)</td>
</tr>
<tr>
<td style="text-align: center;">mySInt.absWithSym</td>
<td style="text-align: center;">返回对称收缩1 bit的UInt的绝对值</td>
<td style="text-align: center;">UInt(w(mySInt)-1 bits)</td>
</tr>
</tbody>
</table><div class="highlight-Scala notranslate"><div class="highlight"><pre><span></span><span class="n">myBool</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">mySInt</span><span class="p">.</span><span class="n">lsb</span><span class="w">    </span><span class="c1">//等价于mySInt(0)</span>

<span class="c1">//拼接</span>
<span class="kd">val</span><span class="w"> </span><span class="n">mySInt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mySInt_1</span><span class="w"> </span><span class="o">@@</span><span class="w"> </span><span class="n">mySInt_1</span><span class="w"> </span><span class="o">@@</span><span class="w"> </span><span class="n">myBool</span><span class="w"></span>
<span class="kd">val</span><span class="w"> </span><span class="n">myBits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mySInt_1</span><span class="w"> </span><span class="o">##</span><span class="w"> </span><span class="n">mySInt_1</span><span class="w"> </span><span class="o">##</span><span class="w"> </span><span class="n">myBool</span><span class="w"></span>

<span class="c1">//分块</span>
<span class="kd">val</span><span class="w"> </span><span class="n">sel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">UInt</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="n">bits</span><span class="p">)</span><span class="w"></span>
<span class="kd">val</span><span class="w"> </span><span class="n">mySIntWord</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mySInt_128bits</span><span class="p">.</span><span class="n">subdivideIn</span><span class="p">(</span><span class="mi">32</span><span class="w"> </span><span class="n">bits</span><span class="p">)(</span><span class="n">sel</span><span class="p">)</span><span class="w"></span>
<span class="c1">//sel = 0 =&gt; mySIntWord = mySInt_128bits(128 downto 96)</span>
<span class="c1">//sel = 1 =&gt; mySIntWord = mySInt_128bits(95 downto 64)</span>
<span class="c1">//sel = 2 =&gt; mySIntWord = mySInt_128bits(63 downto 32)</span>
<span class="c1">//sel = 3 =&gt; mySIntWord = mySInt_128bits(31 downto 0)</span>

<span class="c1">//如果想要反向访问数据：</span>
<span class="kd">val</span><span class="w"> </span><span class="n">myVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mySInt_128bits</span><span class="p">.</span><span class="n">subdivideIn</span><span class="p">(</span><span class="mi">32</span><span class="w"> </span><span class="n">bits</span><span class="p">).</span><span class="n">reverse</span><span class="w"></span>
<span class="kd">val</span><span class="w"> </span><span class="n">mySIntWord</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myVector</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span><span class="w"></span>

<span class="c1">//变换大小</span>
<span class="n">myUInt_32bits</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nc">U</span><span class="s">&quot;32&#39;x11223344&quot;</span><span class="w"></span>
<span class="n">myUInt_8bits</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">myUInt_32bits</span><span class="p">.</span><span class="n">resized</span><span class="w">   </span><span class="c1">//长度自动推断(myUInt_8bits=0x44)</span>
<span class="n">myUInt_8bits</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">myUInt_32bits</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="c1">//变换为8 bits(myUInt_8bits=0x44)</span>

<span class="c1">//取补码</span>
<span class="n">mySInt</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">myUInt</span><span class="p">.</span><span class="n">twoComplement</span><span class="p">(</span><span class="n">myBool</span><span class="p">)</span><span class="w"></span>

<span class="c1">//取绝对值</span>
<span class="n">mySInt_abs</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">mySInt</span><span class="p">.</span><span class="n">abs</span><span class="w"></span>
</pre></div>
</div>
<p>Verilog:</p>
<div class="highlight-Verilog notranslate"><div class="highlight"><pre><span></span><span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">_zz_mySInt</span><span class="p">;</span><span class="w"></span>
<span class="kt">reg</span><span class="w">        </span><span class="p">[</span><span class="mh">31</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">_zz_mySIntWord</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">31</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">_zz_mySIntWord_1</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">31</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">_zz_mySIntWord_2</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">31</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">_zz_mySIntWord_3</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">31</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">_zz_mySIntWord_4</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">                </span><span class="n">myBool</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">mySInt_1</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">127</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">  </span><span class="n">mySInt_128bits</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">16</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">mySInt</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">16</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">myBits</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">sel</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">31</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">mySIntWord</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">31</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">myUInt_32bits</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">myUInt_8bits</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">myUInt</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">16</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">mySInt_abs</span><span class="p">;</span><span class="w"></span>

<span class="k">assign</span><span class="w"> </span><span class="n">_zz_mySInt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">mySInt_1</span><span class="p">,</span><span class="n">mySInt_1</span><span class="p">};</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">_zz_mySIntWord_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mySInt_128bits</span><span class="p">[</span><span class="mh">31</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">0</span><span class="p">];</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">_zz_mySIntWord_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mySInt_128bits</span><span class="p">[</span><span class="mh">63</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">32</span><span class="p">];</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">_zz_mySIntWord_3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mySInt_128bits</span><span class="p">[</span><span class="mh">95</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">64</span><span class="p">];</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">_zz_mySIntWord_4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mySInt_128bits</span><span class="p">[</span><span class="mh">127</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">96</span><span class="p">];</span><span class="w"></span>
<span class="k">always</span><span class="w"> </span><span class="p">@(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">    </span><span class="k">case</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="mh">2</span><span class="mb">&#39;b00</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">_zz_mySIntWord</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_zz_mySIntWord_1</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="mh">2</span><span class="mb">&#39;b01</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">_zz_mySIntWord</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_zz_mySIntWord_2</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="mh">2</span><span class="mb">&#39;b10</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">_zz_mySIntWord</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_zz_mySIntWord_3</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">default</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">_zz_mySIntWord</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_zz_mySIntWord_4</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">endcase</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="k">assign</span><span class="w"> </span><span class="n">myBool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mySInt</span><span class="p">[</span><span class="mh">0</span><span class="p">];</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">mySInt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">_zz_mySInt</span><span class="p">,</span><span class="n">myBool</span><span class="p">};</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">myBits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{{</span><span class="n">mySInt_1</span><span class="p">,</span><span class="n">mySInt_1</span><span class="p">},</span><span class="n">myBool</span><span class="p">};</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">mySIntWord</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_zz_mySIntWord</span><span class="p">;</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">myUInt_32bits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">32&#39;h11223344</span><span class="p">;</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">myUInt_8bits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myUInt_32bits</span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">];</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">myUInt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8&#39;h28</span><span class="p">;</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">mySInt_abs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">17&#39;h0</span><span class="p">;</span><span class="w"></span>

<span class="k">assign</span><span class="w"> </span><span class="n">_zz_mySInt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">({</span><span class="n">myBool</span><span class="p">,(</span><span class="n">myBool</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">myUInt</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">myUInt</span><span class="p">)}</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">_zz_mySInt_1</span><span class="p">);</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">_zz_mySInt_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myBool</span><span class="p">;</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">_zz_mySInt_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mh">8</span><span class="mi">&#39;d0</span><span class="p">,</span><span class="w"> </span><span class="n">_zz_mySInt_2</span><span class="p">};</span><span class="w"></span>

<span class="k">assign</span><span class="w"> </span><span class="n">_zz_mySInt_abs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">mySInt</span><span class="p">[</span><span class="mh">8</span><span class="p">]</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">_zz_mySInt_abs_1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">mySInt</span><span class="p">);</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">_zz_mySInt_abs_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">mySInt</span><span class="p">);</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">_zz_mySInt_abs_3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mySInt</span><span class="p">[</span><span class="mh">8</span><span class="p">];</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">_zz_mySInt_abs_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mh">8</span><span class="mi">&#39;d0</span><span class="p">,</span><span class="w"> </span><span class="n">_zz_mySInt_abs_3</span><span class="p">};</span><span class="w"></span>

<span class="k">assign</span><span class="w"> </span><span class="n">mySInt_abs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">_zz_mySInt_abs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">_zz_mySInt_abs_2</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="fixpoint-operations">
<h2>四、定点数操作(FixPoint operations)<a class="headerlink" href="#fixpoint-operations" title="此标题的永久链接"></a></h2>
<p>对于定点数, 我们可以把它分成两个部分：</p>
<ul class="simple">
<li><p>低位操作(四舍五入)</p></li>
<li><p>高位操作(饱和运算)</p></li>
</ul>
<ol>
<li><p>低位操作(Lower bit operations)</p>
<p><img alt="lowerBitOperation" src="../../_images/lowerBitOperation.png" /></p>
</li>
</ol>
<table border="1" class="docutils">
<thead>
<tr>
<th style="text-align: center;">SpinalHDL舍入类型</th>
<th style="text-align: center;">Wikipedia舍入类型</th>
<th style="text-align: center;">API</th>
<th style="text-align: center;">数学算法</th>
<th style="text-align: center;">返回(align=false)</th>
<th style="text-align: center;">支持程度</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">FLOOR</td>
<td style="text-align: center;">RoundDown</td>
<td style="text-align: center;">floor</td>
<td style="text-align: center;">floor(x)</td>
<td style="text-align: center;">w(x)-n bits</td>
<td style="text-align: center;">Yes</td>
</tr>
<tr>
<td style="text-align: center;">FLOORTOZERO</td>
<td style="text-align: center;">RoundToZero</td>
<td style="text-align: center;">floorToZero</td>
<td style="text-align: center;">sign*floor(abs(x))</td>
<td style="text-align: center;">w(x)-n bits</td>
<td style="text-align: center;">Yes</td>
</tr>
<tr>
<td style="text-align: center;">CEIL</td>
<td style="text-align: center;">RoundUp</td>
<td style="text-align: center;">ceil</td>
<td style="text-align: center;">ceil(x)</td>
<td style="text-align: center;">w(x)-n+1 bits</td>
<td style="text-align: center;">Yes</td>
</tr>
<tr>
<td style="text-align: center;">CEILTOINF</td>
<td style="text-align: center;">RoundToInf</td>
<td style="text-align: center;">ceilToInf</td>
<td style="text-align: center;">sign*ceil(abs(x))</td>
<td style="text-align: center;">w(x)-n+1 bits</td>
<td style="text-align: center;">Yes</td>
</tr>
<tr>
<td style="text-align: center;">ROUNDUP</td>
<td style="text-align: center;">RoundHalfUp</td>
<td style="text-align: center;">roundUp</td>
<td style="text-align: center;">floor(x+0.5)</td>
<td style="text-align: center;">w(x)-n+1 bits</td>
<td style="text-align: center;">Yes</td>
</tr>
<tr>
<td style="text-align: center;">ROUNDDOWN</td>
<td style="text-align: center;">RoundHalfDown</td>
<td style="text-align: center;">roundDown</td>
<td style="text-align: center;">ceil(x-0.5)</td>
<td style="text-align: center;">w(x)-n+1 bits</td>
<td style="text-align: center;">Yes</td>
</tr>
<tr>
<td style="text-align: center;">ROUNDTOZERO</td>
<td style="text-align: center;">RoundHalfToZero</td>
<td style="text-align: center;">roundToZero</td>
<td style="text-align: center;">sign*ceil(abs(x)-0.5)</td>
<td style="text-align: center;">w(x)-n+1 bits</td>
<td style="text-align: center;">Yes</td>
</tr>
<tr>
<td style="text-align: center;">ROUNDTOINF</td>
<td style="text-align: center;">RoundHalfToInf</td>
<td style="text-align: center;">roundToInf</td>
<td style="text-align: center;">sign*floor(abs(x)+0.5)</td>
<td style="text-align: center;">w(x)-n+1 bits</td>
<td style="text-align: center;">Yes</td>
</tr>
<tr>
<td style="text-align: center;">ROUNDTOEVEN</td>
<td style="text-align: center;">RoundHalfToEven</td>
<td style="text-align: center;">roundToEven</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr>
<td style="text-align: center;">ROUNDTOODD</td>
<td style="text-align: center;">RoundHalfToOdd</td>
<td style="text-align: center;">roundToOdd</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table><blockquote>
<div><p>备注：RoundToEven和RoundToOdd模式都非常特殊, 常用在高精度大数据统计领域, SpinalHDL还没有支持它们。</p>
</div></blockquote>
<p>你会发现ROUNDUP, ROUNDDOWN, ROUNDTOZERO, ROUNDTOINF, ROUNDTOEVEN, ROUNDTOODD在行为上非常相似, ROUNDTOINF所最常见的, 不同编程语言中的四舍五入方法可能不同。</p>
<p>|  编程语言  | 默认四舍五入类型 |                             举例                             |        评估         |
| :——–: | :————–: | :———————————————————-: | :—————–: |  |
|   Matlab   |    ROUNDTOINF    | round(1.5)=2, round(2.5)=3<br>round(-1.5)=-2, round(-2.5)=-3 | round to +-Infinity |
|  python2   |    ROUNDTOINF    | round(1.5)=2, round(2.5)=3<br>round(-1.5)=-2, round(-2.5)=-3 | round to +-Infinity |
|  python3   |   ROUNDTOEVEN    |    round(1.5)=round(2.5)=2<br>round(-1.5)=round(-2.5)=-2     |    close to Even    |
| Scala.math |    ROUNDTOUP     | round(1.5)=2, round(2.5)=3<br>round(-1.5)=-1, round(-2.5)=-2 | always to +Infinity |
| SpinalHDL  |    ROUNDTOINF    | round(1.5)=2, round(2.5)=3<br>round(-1.5)=-2, round(-2.5)=-3 | round to +-Infinity |</p>
<blockquote>
<div><p>备注：在SpinalHDL中ROUNDTOINF默认是RoundType(<code class="docutils literal notranslate"><span class="pre">round</span> <span class="pre">=</span> <span class="pre">roundToInf</span></code>)</p>
</div></blockquote>
<div class="highlight-Scala notranslate"><div class="highlight"><pre><span></span><span class="kd">val</span><span class="w"> </span><span class="nc">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">SInt</span><span class="p">(</span><span class="mi">16</span><span class="w"> </span><span class="n">bits</span><span class="p">)</span><span class="w"></span>
<span class="kd">val</span><span class="w"> </span><span class="nc">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">A</span><span class="p">.</span><span class="n">roundToInf</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="w">    </span><span class="c1">//默认&#39;align=false&#39;, 会得到11 bits</span>
<span class="kd">val</span><span class="w"> </span><span class="nc">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">A</span><span class="p">.</span><span class="n">roundToInf</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="n">align</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w">  </span><span class="c1">//舍去进位, 得到10 bits</span>
<span class="kd">val</span><span class="w"> </span><span class="nc">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">A</span><span class="p">.</span><span class="n">floor</span><span class="p">(</span><span class="mi">6</span><span class="w"> </span><span class="n">bits</span><span class="p">)</span><span class="w">         </span><span class="c1">//返回10 bits</span>
<span class="kd">val</span><span class="w"> </span><span class="nc">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">A</span><span class="p">.</span><span class="n">floorToZero</span><span class="p">(</span><span class="mi">6</span><span class="w"> </span><span class="n">bits</span><span class="p">)</span><span class="w">   </span><span class="c1">//返回10 bits</span>
<span class="kd">val</span><span class="w"> </span><span class="nc">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">A</span><span class="p">.</span><span class="n">ceil</span><span class="p">(</span><span class="mi">6</span><span class="w"> </span><span class="n">bits</span><span class="p">)</span><span class="w">          </span><span class="c1">//带进位故返回11 bits</span>
<span class="kd">val</span><span class="w"> </span><span class="nc">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">A</span><span class="p">.</span><span class="n">ceil</span><span class="p">(</span><span class="mi">6</span><span class="w"> </span><span class="n">bits</span><span class="p">,</span><span class="w"> </span><span class="n">align</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w">    </span><span class="c1">//舍去进位, 得到10 bits</span>
<span class="kd">val</span><span class="w"> </span><span class="nc">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">A</span><span class="p">.</span><span class="n">ceilToInf</span><span class="p">(</span><span class="mi">6</span><span class="w"> </span><span class="n">bits</span><span class="p">)</span><span class="w"></span>
<span class="kd">val</span><span class="w"> </span><span class="nc">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">A</span><span class="p">.</span><span class="n">roundUp</span><span class="p">(</span><span class="mi">6</span><span class="w"> </span><span class="n">bits</span><span class="p">)</span><span class="w"></span>
<span class="kd">val</span><span class="w"> </span><span class="nc">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">A</span><span class="p">.</span><span class="n">roundDown</span><span class="p">(</span><span class="mi">6</span><span class="w"> </span><span class="n">bits</span><span class="p">)</span><span class="w"></span>
<span class="kd">val</span><span class="w"> </span><span class="nc">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">A</span><span class="p">.</span><span class="n">roundToInf</span><span class="p">(</span><span class="mi">6</span><span class="w"> </span><span class="n">bits</span><span class="p">)</span><span class="w"></span>
<span class="kd">val</span><span class="w"> </span><span class="nc">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">A</span><span class="p">.</span><span class="n">roundToZero</span><span class="p">(</span><span class="mi">6</span><span class="w"> </span><span class="n">bits</span><span class="p">)</span><span class="w"></span>
<span class="kd">val</span><span class="w"> </span><span class="nc">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">A</span><span class="p">.</span><span class="n">round</span><span class="p">(</span><span class="mi">6</span><span class="w"> </span><span class="n">bits</span><span class="p">)</span><span class="w">         </span><span class="c1">//SpinalHDL用roundToInf作为默认rounding模式</span>

<span class="kd">val</span><span class="w"> </span><span class="nc">B0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">A</span><span class="p">.</span><span class="n">roundToInf</span><span class="p">(</span><span class="mi">6</span><span class="w"> </span><span class="n">bits</span><span class="p">,</span><span class="w"> </span><span class="n">align</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="c1">//---+</span>
<span class="w">                                            </span><span class="c1">//--&gt; equal</span>
<span class="kd">val</span><span class="w"> </span><span class="nc">B1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">A</span><span class="p">.</span><span class="n">roundToInf</span><span class="p">(</span><span class="mi">6</span><span class="w"> </span><span class="n">bits</span><span class="p">,</span><span class="w"> </span><span class="n">align</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">).</span><span class="n">sat</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="c1">//---+</span>
</pre></div>
</div>
<p>Verilog:</p>
<div class="highlight-Verilog notranslate"><div class="highlight"><pre><span></span><span class="c1">//这里只举一个例子，其他的可自行生成</span>
<span class="c1">//val B = A.roundToInf(6, align = true)     当前版本默认align = true，与文档有所不同    有符号数两边近似</span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">16</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">_zz__zz_when_SInt_l337_2</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">16</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">_zz__zz_when_SInt_l337_2_1</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">5</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">_zz_when_SInt_l191</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">10</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">_zz__zz_B_3</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">10</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">_zz__zz_B_3_1</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">16</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">_zz__zz_B</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">16</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">_zz__zz_B_1</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">16</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">_zz__zz_B_2</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">_zz_when_SInt_l131</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">0</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">_zz_when_SInt_l137</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">A</span><span class="p">;</span><span class="w"></span>
<span class="kt">reg</span><span class="w">        </span><span class="p">[</span><span class="mh">10</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">_zz_B</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">_zz_B_1</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">_zz_when_SInt_l337</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">_zz_when_SInt_l337_1</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">16</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">_zz_when_SInt_l337_2</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">_zz_B_2</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">                </span><span class="n">when_SInt_l337</span><span class="p">;</span><span class="w"></span>
<span class="kt">reg</span><span class="w">        </span><span class="p">[</span><span class="mh">10</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">_zz_B_3</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">                </span><span class="n">when_SInt_l191</span><span class="p">;</span><span class="w"></span>
<span class="kt">reg</span><span class="w">        </span><span class="p">[</span><span class="mh">9</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">B</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">                </span><span class="n">when_SInt_l130</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">                </span><span class="n">when_SInt_l131</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">                </span><span class="n">when_SInt_l137</span><span class="p">;</span><span class="w"></span>
<span class="kt">reg</span><span class="w">        </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">counter</span><span class="p">;</span><span class="w"></span>

<span class="k">assign</span><span class="w"> </span><span class="n">_zz__zz_when_SInt_l337_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">_zz_when_SInt_l337_1</span><span class="p">[</span><span class="mh">15</span><span class="p">],</span><span class="n">_zz_when_SInt_l337_1</span><span class="p">};</span><span class="w">  </span><span class="c1">//A符号位拓展1bit</span>
<span class="k">assign</span><span class="w"> </span><span class="n">_zz__zz_when_SInt_l337_2_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">_zz_when_SInt_l337</span><span class="p">[</span><span class="mh">15</span><span class="p">],</span><span class="n">_zz_when_SInt_l337</span><span class="p">};</span><span class="w">    </span><span class="c1">//前6bit为0，其余为1的符号位拓展, 即-2^5</span>
<span class="k">assign</span><span class="w"> </span><span class="n">_zz_when_SInt_l191</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_zz_when_SInt_l337_2</span><span class="p">[</span><span class="mh">5</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">0</span><span class="p">];</span><span class="w">                            </span><span class="c1">//A-0.5的小数部分</span>
<span class="k">assign</span><span class="w"> </span><span class="n">_zz__zz_B_3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_zz_when_SInt_l337_2</span><span class="p">[</span><span class="mh">16</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">6</span><span class="p">];</span><span class="w">                                  </span><span class="c1">//A-0.5的整数部分</span>
<span class="k">assign</span><span class="w"> </span><span class="n">_zz__zz_B_3_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">11&#39;h001</span><span class="p">;</span><span class="w">                                                     </span><span class="c1">//1</span>
<span class="k">assign</span><span class="w"> </span><span class="n">_zz__zz_B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">$signed</span><span class="p">(</span><span class="n">_zz__zz_B_1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">$signed</span><span class="p">(</span><span class="n">_zz__zz_B_2</span><span class="p">));</span><span class="w">                   </span><span class="c1">//符号位拓展后的A+2^5, 相当于A+0.5</span>
<span class="k">assign</span><span class="w"> </span><span class="n">_zz__zz_B_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">_zz_B_2</span><span class="p">[</span><span class="mh">15</span><span class="p">],</span><span class="n">_zz_B_2</span><span class="p">};</span><span class="w">                                         </span><span class="c1">//A符号位拓展1bit</span>
<span class="k">assign</span><span class="w"> </span><span class="n">_zz__zz_B_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">_zz_B_1</span><span class="p">[</span><span class="mh">15</span><span class="p">],</span><span class="n">_zz_B_1</span><span class="p">};</span><span class="w">                                         </span><span class="c1">//2^5符号位拓展1bit</span>
<span class="k">assign</span><span class="w"> </span><span class="n">_zz_when_SInt_l131</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_zz_B</span><span class="p">[</span><span class="mh">10</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">9</span><span class="p">];</span><span class="w">                                          </span><span class="c1">//溢出判断位</span>
<span class="k">assign</span><span class="w"> </span><span class="n">_zz_when_SInt_l137</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_zz_B</span><span class="p">[</span><span class="mh">9</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">9</span><span class="p">];</span><span class="w">                                           </span><span class="c1">//符号位</span>
<span class="k">assign</span><span class="w"> </span><span class="n">_zz_B_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{{</span><span class="mh">10&#39;h0</span><span class="p">,</span><span class="mh">1</span><span class="mb">&#39;b1</span><span class="p">},</span><span class="mh">5&#39;h0</span><span class="p">};</span><span class="w">                                               </span><span class="c1">//16‘b0000_0000_0010_0000, 即2^5</span>
<span class="k">assign</span><span class="w"> </span><span class="n">_zz_when_SInt_l337</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mh">11&#39;h7ff</span><span class="p">,</span><span class="mh">5&#39;h0</span><span class="p">};</span><span class="w">                                         </span><span class="c1">//前5bit为0，其余为1. 即-2^5</span>
<span class="k">assign</span><span class="w"> </span><span class="n">_zz_when_SInt_l337_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="mh">15</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">0</span><span class="p">];</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">_zz_when_SInt_l337_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">$signed</span><span class="p">(</span><span class="n">_zz__zz_when_SInt_l337_2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">$signed</span><span class="p">(</span><span class="n">_zz__zz_when_SInt_l337_2_1</span><span class="p">));</span><span class="w">    </span><span class="c1">//符号位拓展后的A-2^5, 相当于A-0.5</span>
<span class="k">assign</span><span class="w"> </span><span class="n">_zz_B_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="mh">15</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">0</span><span class="p">];</span><span class="w">                                                         </span><span class="c1">//A</span>
<span class="k">assign</span><span class="w"> </span><span class="n">when_SInt_l337</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_zz_when_SInt_l337_2</span><span class="p">[</span><span class="mh">16</span><span class="p">];</span><span class="w">                                   </span><span class="c1">//A-0.5符号位</span>
<span class="k">assign</span><span class="w"> </span><span class="n">when_SInt_l191</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">|</span><span class="n">_zz_when_SInt_l191</span><span class="p">);</span><span class="w">                                      </span><span class="c1">//A-0.5小数部分是否为0</span>
<span class="k">always</span><span class="w"> </span><span class="p">@(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">when_SInt_l191</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="n">_zz_B_3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">$signed</span><span class="p">(</span><span class="n">_zz__zz_B_3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">$signed</span><span class="p">(</span><span class="n">_zz__zz_B_3_1</span><span class="p">));</span><span class="w">                  </span><span class="c1">//非0的话A-0.5的整数部分+1</span>
<span class="w">    </span><span class="k">end</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="n">_zz_B_3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_zz_when_SInt_l337_2</span><span class="p">[</span><span class="mh">16</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">6</span><span class="p">];</span><span class="w">                                     </span><span class="c1">//0的话结果为 A-0.5 整数部分</span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="k">always</span><span class="w"> </span><span class="p">@(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">when_SInt_l337</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w">                                                        </span><span class="c1">//负数时取</span>
<span class="w">        </span><span class="n">_zz_B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_zz_B_3</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="n">_zz_B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">_zz__zz_B</span><span class="w"> </span><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="mh">6</span><span class="p">);</span><span class="w">                                                  </span><span class="c1">//非负时A+0.5整数部分</span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="k">assign</span><span class="w"> </span><span class="n">when_SInt_l130</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_zz_B</span><span class="p">[</span><span class="mh">10</span><span class="p">];</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">when_SInt_l131</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="n">_zz_when_SInt_l131</span><span class="p">));</span><span class="w"></span>
<span class="k">always</span><span class="w"> </span><span class="p">@(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">when_SInt_l130</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">when_SInt_l131</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">10&#39;h200</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_zz_B</span><span class="p">[</span><span class="mh">9</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">0</span><span class="p">];</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">when_SInt_l137</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">10&#39;h1ff</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_zz_B</span><span class="p">[</span><span class="mh">9</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">0</span><span class="p">];</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="k">assign</span><span class="w"> </span><span class="n">when_SInt_l137</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">|</span><span class="n">_zz_when_SInt_l137</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<blockquote>
<div><p>备注：只有<code class="docutils literal notranslate"><span class="pre">floor</span></code>和<code class="docutils literal notranslate"><span class="pre">floorToZero</span></code>没有<code class="docutils literal notranslate"><span class="pre">align</span></code>选项, 它们不需要进位bit(align=true)。其他近似算法都默认带进位信息。</p>
</div></blockquote>
<table border="1" class="docutils">
<thead>
<tr>
<th style="text-align: center;">API</th>
<th style="text-align: center;">UInt/SInt</th>
<th style="text-align: center;">描述</th>
<th style="text-align: center;">Return(align=false)</th>
<th style="text-align: center;">Return(align=true)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">floor</td>
<td style="text-align: center;">Both</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">w(x)-n bits</td>
<td style="text-align: center;">w(x)-n bits</td>
</tr>
<tr>
<td style="text-align: center;">floorToZero</td>
<td style="text-align: center;">SInt</td>
<td style="text-align: center;">与无符号floor相等</td>
<td style="text-align: center;">w(x)-n bits</td>
<td style="text-align: center;">w(x)-n bits</td>
</tr>
<tr>
<td style="text-align: center;">ceil</td>
<td style="text-align: center;">Both</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">w(x)-n+1 bits</td>
<td style="text-align: center;">w(x)-n bits</td>
</tr>
<tr>
<td style="text-align: center;">ceilToInf</td>
<td style="text-align: center;">SInt</td>
<td style="text-align: center;">与无符号ceil相等</td>
<td style="text-align: center;">w(x)-n+1 bits</td>
<td style="text-align: center;">w(x)-n bits</td>
</tr>
<tr>
<td style="text-align: center;">roundUp</td>
<td style="text-align: center;">Both</td>
<td style="text-align: center;">仅为了HW</td>
<td style="text-align: center;">w(x)-n+1 bits</td>
<td style="text-align: center;">w(x)-n bits</td>
</tr>
<tr>
<td style="text-align: center;">roundDown</td>
<td style="text-align: center;">Both</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">w(x)-n+1 bits</td>
<td style="text-align: center;">w(x)-n bits</td>
</tr>
<tr>
<td style="text-align: center;">roundToInf</td>
<td style="text-align: center;">SInt</td>
<td style="text-align: center;">最常用</td>
<td style="text-align: center;">w(x)-n+1 bits</td>
<td style="text-align: center;">w(x)-n bits</td>
</tr>
<tr>
<td style="text-align: center;">roundToZero</td>
<td style="text-align: center;">SInt</td>
<td style="text-align: center;">无符号时等于roundDown</td>
<td style="text-align: center;">w(x)-n+1 bits</td>
<td style="text-align: center;">w(x)-n bits</td>
</tr>
<tr>
<td style="text-align: center;">round</td>
<td style="text-align: center;">Both</td>
<td style="text-align: center;">在SpinalHDL中默认roundToInf</td>
<td style="text-align: center;">w(x)-n+1 bits</td>
<td style="text-align: center;">w(x)-n bits</td>
</tr>
</tbody>
</table><blockquote>
<div><p>备注：尽管<code class="docutils literal notranslate"><span class="pre">roundToInf</span></code>很常用, <code class="docutils literal notranslate"><span class="pre">roundUp</span></code>有着最小的开销和最好的时序, 并且几乎没有性能损失。因此强烈推荐使用<code class="docutils literal notranslate"><span class="pre">roundUp</span></code></p>
</div></blockquote>
<ol>
<li><p>高位操作(High bit operations)</p>
<p><img alt="highBitOperation" src="../../_images/highBitOperation.png" /></p>
</li>
</ol>
<table border="1" class="docutils">
<thead>
<tr>
<th style="text-align: center;">函数</th>
<th style="text-align: center;">操作</th>
<th style="text-align: center;">正数操作</th>
<th style="text-align: center;">负数操作</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">sat</td>
<td style="text-align: center;">饱和</td>
<td style="text-align: center;">when(Top[w-1, w-n].orR)set maxValue</td>
<td style="text-align: center;">when(Top[w-1, w-n].andR)set minValue</td>
</tr>
<tr>
<td style="text-align: center;">trim</td>
<td style="text-align: center;">舍弃</td>
<td style="text-align: center;">N/A</td>
<td style="text-align: center;">N/A</td>
</tr>
<tr>
<td style="text-align: center;">symmetry</td>
<td style="text-align: center;">对称</td>
<td style="text-align: center;">N/A</td>
<td style="text-align: center;">minValue=-maxValue</td>
</tr>
</tbody>
</table><p>对称仅对<code class="docutils literal notranslate"><span class="pre">SInt</span></code>有效</p>
<div class="highlight-Scala notranslate"><div class="highlight"><pre><span></span><span class="kd">val</span><span class="w"> </span><span class="nc">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">SInt</span><span class="p">(</span><span class="mi">8</span><span class="w"> </span><span class="n">bits</span><span class="p">)</span><span class="w"></span>
<span class="kd">val</span><span class="w"> </span><span class="nc">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">A</span><span class="p">.</span><span class="n">sat</span><span class="p">(</span><span class="mi">3</span><span class="w"> </span><span class="n">bits</span><span class="p">)</span><span class="w">       </span><span class="c1">//高3 bits饱和的5 bits返回值</span>
<span class="kd">val</span><span class="w"> </span><span class="nc">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">A</span><span class="p">.</span><span class="n">sat</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w">            </span><span class="c1">//与上式同理</span>
<span class="kd">val</span><span class="w"> </span><span class="nc">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">A</span><span class="p">.</span><span class="n">trim</span><span class="p">(</span><span class="mi">3</span><span class="w"> </span><span class="n">bits</span><span class="p">)</span><span class="w">      </span><span class="c1">//高3 bits舍弃的5bits返回值</span>
<span class="kd">val</span><span class="w"> </span><span class="nc">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">A</span><span class="p">.</span><span class="n">symmetry</span><span class="w">          </span><span class="c1">//像(-128~127 to -127~127)一样返回8 bits</span>
<span class="kd">val</span><span class="w"> </span><span class="nc">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">A</span><span class="p">.</span><span class="n">sat</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="n">symmetry</span><span class="w">          </span><span class="c1">//像(-16~15 to -15~15)一样返回5 bits</span>
</pre></div>
</div>
<p>Verilog:</p>
<div class="highlight-Verilog notranslate"><div class="highlight"><pre><span></span><span class="c1">//饱和</span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">_zz_when_SInt_l131</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">2</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">_zz_when_SInt_l137</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">A</span><span class="p">;</span><span class="w"></span>
<span class="kt">reg</span><span class="w">        </span><span class="p">[</span><span class="mh">4</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">B</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">                </span><span class="n">when_SInt_l130</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">                </span><span class="n">when_SInt_l131</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">                </span><span class="n">when_SInt_l137</span><span class="p">;</span><span class="w"></span>

<span class="k">assign</span><span class="w"> </span><span class="n">_zz_when_SInt_l131</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="mh">7</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">4</span><span class="p">];</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">_zz_when_SInt_l137</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="mh">6</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">4</span><span class="p">];</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">when_SInt_l130</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="mh">7</span><span class="p">];</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">when_SInt_l131</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="n">_zz_when_SInt_l131</span><span class="p">));</span><span class="w"></span>
<span class="k">always</span><span class="w"> </span><span class="p">@(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">when_SInt_l130</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">when_SInt_l131</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">5&#39;h10</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="mh">4</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">0</span><span class="p">];</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">when_SInt_l137</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">5&#39;h0f</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="mh">4</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">0</span><span class="p">];</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="k">assign</span><span class="w"> </span><span class="n">when_SInt_l137</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">|</span><span class="n">_zz_when_SInt_l137</span><span class="p">);</span><span class="w"></span>

<span class="c1">//trim舍弃</span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">A</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">4</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">B</span><span class="p">;</span><span class="w"></span>

<span class="k">assign</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="mh">4</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">0</span><span class="p">];</span><span class="w"></span>

<span class="c1">//对称</span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">_zz_B</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">_zz_B_1</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">A</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">B</span><span class="p">;</span><span class="w"></span>

<span class="k">assign</span><span class="w"> </span><span class="n">_zz_B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8&#39;h80</span><span class="p">;</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">_zz_B_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8&#39;h81</span><span class="p">;</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">$signed</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">$signed</span><span class="p">(</span><span class="n">_zz_B</span><span class="p">))</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">_zz_B_1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">A</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<ol>
<li><p>fixTo函数(fixTo function)</p>
<p>针对<code class="docutils literal notranslate"><span class="pre">UInt</span></code>/<code class="docutils literal notranslate"><span class="pre">SInt</span></code>提供了两种定点方法：</p>
<p><img alt="fixPoint" src="../../_images/fixPoint.png" /></p>
<p>强烈推荐在RTL工程中使用<code class="docutils literal notranslate"><span class="pre">fixTo</span></code>, 有了这个函数你就不需要处理进位alignment和bit宽度的计算问题, 如同上图Way1那样。</p>
<p>Fix函数关于自动处理饱和：</p>
</li>
</ol>
<table border="1" class="docutils">
<thead>
<tr>
<th style="text-align: center;">函数</th>
<th style="text-align: center;">描述</th>
<th style="text-align: center;">返回类型</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">fixTo(section, roundType, symmetric)</td>
<td style="text-align: center;">Factory FixFunction</td>
<td style="text-align: center;">section.size bits</td>
</tr>
</tbody>
</table><div class="highlight-Scala notranslate"><div class="highlight"><pre><span></span><span class="kd">val</span><span class="w"> </span><span class="nc">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">SInt</span><span class="p">(</span><span class="mi">16</span><span class="w"> </span><span class="n">bits</span><span class="p">)</span><span class="w"></span>
<span class="kd">val</span><span class="w"> </span><span class="nc">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">A</span><span class="p">.</span><span class="n">fixTo</span><span class="p">(</span><span class="mi">10</span><span class="w"> </span><span class="n">downto</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="c1">//默认的RoundType是ROUNDTOINF, sym=false</span>
<span class="kd">val</span><span class="w"> </span><span class="nc">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">A</span><span class="p">.</span><span class="n">fixTo</span><span class="p">(</span><span class="mi">8</span><span class="w"> </span><span class="n">downto</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nc">RoundType</span><span class="p">.</span><span class="nc">ROUNDUP</span><span class="p">)</span><span class="w"></span>
<span class="kd">val</span><span class="w"> </span><span class="nc">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">A</span><span class="p">.</span><span class="n">fixTo</span><span class="p">(</span><span class="mi">9</span><span class="w"> </span><span class="n">downto</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="nc">RoundType</span><span class="p">.</span><span class="nc">CEIL</span><span class="p">,</span><span class="w"> </span><span class="n">sym</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"></span>
<span class="kd">val</span><span class="w"> </span><span class="nc">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">A</span><span class="p">.</span><span class="n">fixTo</span><span class="p">(</span><span class="mi">16</span><span class="w"> </span><span class="n">downto</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nc">RoundType</span><span class="p">.</span><span class="nc">ROUNDTOINF</span><span class="p">,</span><span class="w"> </span><span class="n">sym</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w"></span>
<span class="kd">val</span><span class="w"> </span><span class="nc">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">A</span><span class="p">.</span><span class="n">fixTo</span><span class="p">(</span><span class="mi">10</span><span class="w"> </span><span class="n">downto</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="nc">RoundType</span><span class="p">.</span><span class="nc">FLOOR</span><span class="p">)</span><span class="w">   </span><span class="c1">//向下取整3 bits, 舍弃进位5 bits @ highest</span>
<span class="kd">val</span><span class="w"> </span><span class="nc">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">A</span><span class="p">.</span><span class="n">fixTo</span><span class="p">(</span><span class="mi">20</span><span class="w"> </span><span class="n">downto</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="nc">RoundType</span><span class="p">.</span><span class="nc">FLOOR</span><span class="p">)</span><span class="w">   </span><span class="c1">//向下取整3 bits,拓展进位2 bits @ highest</span>
</pre></div>
</div>
<p>Verilog:</p>
<div class="highlight-Verilog notranslate"><div class="highlight"><pre><span></span><span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">fixTo_dout</span><span class="p">;</span><span class="w"></span>
<span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">A</span><span class="p">;</span><span class="w"></span>

<span class="n">SInt16fixTo10_3_ROUNDTOINF</span><span class="w"> </span><span class="n">fixTo</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="n">din</span><span class="w">  </span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">        </span><span class="p">),</span><span class="w"> </span><span class="c1">//i</span>
<span class="w">    </span><span class="p">.</span><span class="n">dout</span><span class="w"> </span><span class="p">(</span><span class="n">fixTo_dout</span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">])</span><span class="w">  </span><span class="c1">//o</span>
<span class="p">);</span><span class="w"></span>

<span class="k">module</span><span class="w"> </span><span class="n">SInt16fixTo10_3_ROUNDTOINF</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">  </span><span class="k">input</span><span class="w">      </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">din</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="k">output</span><span class="w">     </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">dout</span><span class="w"></span>
<span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">16</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">_zz__zz_dout_4</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">16</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">_zz__zz_dout_4_1</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">2</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">_zz_when_SInt_l191</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">13</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">_zz__zz_dout_6</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">13</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">_zz__zz_dout_6_1</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">16</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">_zz__zz_dout</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">16</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">_zz__zz_dout_1</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">16</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">_zz__zz_dout_2</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">6</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">_zz_when_SInt_l131</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">5</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">_zz_when_SInt_l137</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">reg</span><span class="w">        </span><span class="p">[</span><span class="mh">13</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">_zz_dout</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">_zz_dout_1</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">_zz_dout_2</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">_zz_dout_3</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">16</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">_zz_dout_4</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">wire</span><span class="w">       </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">_zz_dout_5</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">wire</span><span class="w">                </span><span class="n">when_SInt_l337</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">reg</span><span class="w">        </span><span class="p">[</span><span class="mh">13</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="n">_zz_dout_6</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">wire</span><span class="w">                </span><span class="n">when_SInt_l191</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">reg</span><span class="w">        </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">    </span><span class="n">_zz_dout_7</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">wire</span><span class="w">                </span><span class="n">when_SInt_l130</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">wire</span><span class="w">                </span><span class="n">when_SInt_l131</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">wire</span><span class="w">                </span><span class="n">when_SInt_l137</span><span class="p">;</span><span class="w"></span>

<span class="k">assign</span><span class="w"> </span><span class="n">_zz__zz_dout_4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">_zz_dout_3</span><span class="p">[</span><span class="mh">15</span><span class="p">],</span><span class="n">_zz_dout_3</span><span class="p">};</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">_zz__zz_dout_4_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">_zz_dout_2</span><span class="p">[</span><span class="mh">15</span><span class="p">],</span><span class="n">_zz_dout_2</span><span class="p">};</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">_zz_when_SInt_l191</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_zz_dout_4</span><span class="p">[</span><span class="mh">2</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">0</span><span class="p">];</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">_zz__zz_dout_6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_zz_dout_4</span><span class="p">[</span><span class="mh">16</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">3</span><span class="p">];</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">_zz__zz_dout_6_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">14&#39;h0001</span><span class="p">;</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">_zz__zz_dout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">$signed</span><span class="p">(</span><span class="n">_zz__zz_dout_1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">$signed</span><span class="p">(</span><span class="n">_zz__zz_dout_2</span><span class="p">));</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">_zz__zz_dout_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">_zz_dout_5</span><span class="p">[</span><span class="mh">15</span><span class="p">],</span><span class="n">_zz_dout_5</span><span class="p">};</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">_zz__zz_dout_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">_zz_dout_1</span><span class="p">[</span><span class="mh">15</span><span class="p">],</span><span class="n">_zz_dout_1</span><span class="p">};</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">_zz_when_SInt_l131</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_zz_dout</span><span class="p">[</span><span class="mh">13</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">7</span><span class="p">];</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">_zz_when_SInt_l137</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_zz_dout</span><span class="p">[</span><span class="mh">12</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">7</span><span class="p">];</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">_zz_dout_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{{</span><span class="mh">13&#39;h0</span><span class="p">,</span><span class="mh">1</span><span class="mb">&#39;b1</span><span class="p">},</span><span class="mh">2</span><span class="mb">&#39;b00</span><span class="p">};</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">_zz_dout_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mh">14&#39;h3fff</span><span class="p">,</span><span class="mh">2</span><span class="mb">&#39;b00</span><span class="p">};</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">_zz_dout_3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">din</span><span class="p">[</span><span class="mh">15</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">0</span><span class="p">];</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">_zz_dout_4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">$signed</span><span class="p">(</span><span class="n">_zz__zz_dout_4</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">$signed</span><span class="p">(</span><span class="n">_zz__zz_dout_4_1</span><span class="p">));</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">_zz_dout_5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">din</span><span class="p">[</span><span class="mh">15</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">0</span><span class="p">];</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">when_SInt_l337</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_zz_dout_4</span><span class="p">[</span><span class="mh">16</span><span class="p">];</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">when_SInt_l191</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">|</span><span class="n">_zz_when_SInt_l191</span><span class="p">);</span><span class="w"></span>
<span class="k">always</span><span class="w"> </span><span class="p">@(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">when_SInt_l191</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="n">_zz_dout_6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">$signed</span><span class="p">(</span><span class="n">_zz__zz_dout_6</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">$signed</span><span class="p">(</span><span class="n">_zz__zz_dout_6_1</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="n">_zz_dout_6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_zz_dout_4</span><span class="p">[</span><span class="mh">16</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">3</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="k">always</span><span class="w"> </span><span class="p">@(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">when_SInt_l337</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="n">_zz_dout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_zz_dout_6</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="n">_zz_dout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">_zz__zz_dout</span><span class="w"> </span><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="mh">3</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="k">assign</span><span class="w"> </span><span class="n">when_SInt_l130</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_zz_dout</span><span class="p">[</span><span class="mh">13</span><span class="p">];</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">when_SInt_l131</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="n">_zz_when_SInt_l131</span><span class="p">));</span><span class="w"></span>
<span class="k">always</span><span class="w"> </span><span class="p">@(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">when_SInt_l130</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">when_SInt_l131</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">_zz_dout_7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8&#39;h80</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">_zz_dout_7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_zz_dout</span><span class="p">[</span><span class="mh">7</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">0</span><span class="p">];</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">when_SInt_l137</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">_zz_dout_7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8&#39;h7f</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">_zz_dout_7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_zz_dout</span><span class="p">[</span><span class="mh">7</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mh">0</span><span class="p">];</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="k">assign</span><span class="w"> </span><span class="n">when_SInt_l137</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">|</span><span class="n">_zz_when_SInt_l137</span><span class="p">);</span><span class="w"></span>
<span class="k">assign</span><span class="w"> </span><span class="n">dout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_zz_dout_7</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Bits.html" class="btn btn-neutral float-left" title="Bits" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="SpinalEnum.html" class="btn btn-neutral float-right" title="SpinalEnum" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2022, THU-CGRA.</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用了 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a>开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>